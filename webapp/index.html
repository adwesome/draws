<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Розыгрыш подарков</title>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4DSL3R9T5W"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4DSL3R9T5W');
    </script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- https://core.telegram.org/bots/webapps#initializing-web-apps -->
    <script src="src/telegram/telegram-web-app.js"></script>
    <!--script src="https://telegram.org/js/telegram-web-app.js"></script-->

    <!-- https://dev.vk.com/ru/bridge/getting-started -->
    <!--script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <script>
      vkBridge.send('VKWebAppInit');
    </script-->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script type="text/javascript" src="src/nanobar/nanobar.min.js"></script>

    <link rel="stylesheet" href="src/flipdown/flipdown.min.css"/>
    <script type="text/javascript" src="src/flipdown/flipdown.min.js"></script>
    
    <link rel="stylesheet" href="src/first_screen.css"/>
    <link rel="stylesheet" href="src/second_screen.css"/>

    <link rel="stylesheet" href="src/play.css"/>
    <style type="text/css"></style>

    <script type="text/javascript" src="src/common.js?v=3"></script>
    <script type="text/javascript" src="src/first_screen.js?v=3"></script>
    <!--script type="text/javascript" src="src/second_screen.js?v=3"></script-->
    <script type="text/javascript" src="src/poll.js?v=3"></script>
    <script type="text/javascript" src="src/play.js?v=3"></script>
    <script type="text/javascript">
      window.onload = async function() {
        tguid = get_tguid_from_url();
        if (tguid == -1) {
          let text = '';
          document.getElementById('tg_only').style.display = 'block';
          let uid = localStorage.getItem('uid');
          if (uid) {
            text += '<p>Используя этот браузер, вы участвовали в пробном розыгрыше, который проходил 15-16 ноября 2024.</p><p>Чтобы перенести все ваши ранее выбранные опции (регион, пол, возраст, бренды) и историю розыгрышей в Телеграм, просто пройдите по ';
            text += `<a href="https://telegram.me/adte_bot?start=${uid}">этой ссылке</a> &mdash; и запустите телеграм бота.</p>`;
          }
          else {
            text += '<p>Вы либо не участвовали вовсе в пробном розыгрыше, который проходил 15-16 ноября 2024. Либо участвовали, но с другого браузера.</p><p>Если вы не участвовали, то просто  пройдите по ';
            text += `<a href="https://telegram.me/adte_bot?start">этой ссылке</a> &mdash; и запустите телеграм бота.</p>`;
            text += `<p>Но, если вы участвовали, и видите это сообщение, то скопируйте и откройте эту ссылку: <a href="https://adwesome.github.io/draws/webapp?v=1">https://adwesome.github.io/draws/webapp?v=1</a> в другом браузере на этом же устройстве или откройте ее в браузере на другом устройстве, с которого вы могли участвовать.</p>`;
          }

          text += '</p>';
          document.getElementById('tg_only').innerHTML = text;
          return;
        }

        // global var
        uid = await get_uid(tguid);  // create in case not exists yet

        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
        //window.Telegram.WebApp.requestFullscreen();
        //window.Telegram.WebApp.setBackgroundColor("#fffaf0");  // floralwhite
        window.Telegram.WebApp.setHeaderColor("#fffaf0");  // floralwhite

        play();
        /*
        if (!get_item_from_local_storage('first_screen_passed'))
          draw_demography('first_screen_demography_poll');
        else if (!get_item_from_local_storage('second_screen_passed'))
          second_screen();
        else {
          document.getElementById('first_screen').remove();

          // const demography = get_items_from_local_storage('choices3');
          // save_into_remote_storage('/register/player/demography', demography);
          // const brands = get_items_from_local_storage('choices4');
          // save_into_remote_storage('/register/player/brands', brands);

          play();
        }
        */
      }
    </script>
  </head>
  <body>

    <div id="intro">
      <div class="container">
        <div class="row">
          <div class="col-xl-4 offset-xl-4 col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-12 screen">
            <div class="col-10 offset-1">
              <div id="tg_only"></div>
              <!--div id="first_screen">
                <h2>Добро пожаловать!</h2>
                <p style="margin-bottom: 1em;">Прежде чем перейти к розыгрышам подарков, расскажите нам, пожалуйста, немного о себе. Эта анкета, как и участия в розыгрышах, <b>полностью анонимные</b>.</p>
                <div id="first_screen_demography_poll"></div>
                <div class="d-grid gap-2">
                  <button id="to_second" class="btn btn-primary" disabled>Далее</button>
                </div>
              </div-->
            </div>
          </div>
        </div>
      </div>
      
      <div class="container">
        <div class="row">
          <div class="col-xl-4 offset-xl-4 col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-12 screen">
            <div class="col-10 offset-1">
              <div id="second_screen">
                <p style="margin-bottom: 1em;">Выберите ниже 1 или 2 бренда, в пробном розыгрышах подарков от которых вы хотите поучаствовать:</p>
                <img id="brand-107" class="brand bid-107" src="img/brands/logos/mk.png"><br>
                <img id="brand-55" class="brand bid-55" src="img/brands/logos/lenta.png">
                
                <div class="d-grid gap-2" style="margin-top: 1.2em;">
                  <button id="to_third" class="btn btn-primary" disabled>Начать розыгрыш</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-xl-4 offset-xl-4 col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-12 screen-">

        <div id="third_screen" class="swiper-outer" pagination="true">
          <div class="swiper-wrapper">
            <div class="swiper-slide">
              <div class="swiper-inner">
                <div class="swiper-wrapper">

                  <div class="swiper-slide">
                    <!-- https://codepen.io/Totati/pen/pPXrJV -->
                    <!-- https://github.com/andreruffert/scratchie.js -->
                    <div class="container-" id="js-container">
                      <p id="js-canvas-explain"><b>Полностью</b> сотрите защитный слой и дождитесь, когда экран перевернется, и на нем появится обратный отсчет &mdash; так ваше участие в розыгрыше будет зарегистрировано</p>
                      <canvas class="canvas" id="js-canvas"></canvas>
                      <div id="ad"></div>
                      <div id="ad_explain"><!--p>На этом экране под защитным слоем может находиться какое-то рекламное предложение от компании. Например, объявление о привозе, об акции "скидка на все", предложение посетить магазин / салон в декабре или в январе и т.д. &mdash; что угодно, что вы хотите сообщить вашей аудитории, людям, которые указали, что они <b><i>хотят</i></b> поучаствовать в розыгрыше подарков от вашей организации.</p--></div>
                    </div>
                  </div>

                  <div class="swiper-slide non-white-bg center">
                    <p id="flipdown_header">Через</p>
                    <div id="flipdown" class="flipdown"></div>
                    <div id="flipdown_explain">
                      <p><span class="conditions"><span id="percent"></span>%</span> участников выиграют подарок от <span class="conditions" id="who"></span>. Вы участвуете&nbsp;👍</p>
                    </div>
                  </div>              

                </div>
                <div class="swiper-pagination swiper-inner-pagination"></div>
              </div>
            </div>
            <div class="swiper-slide non-white-bg list-">
              <h2>Ваши розыгрыши</h2>
              <div id="drawings_list">
                <div id="yesterday">
                  <!--h3>Вчера и позавчера</h3-->
                  <h3>Вчера</h3>
                  <div id="just"><p>Нет</p></div>  
                </div>
                <h3>Сегодня</h3>
                <div id="now"><p>Нет</p></div>
                <h3>Завтра</h3>
                <div id="next"><p>Нет</p></div>
              <h2 style="margin: 1.5em 0 0.3em 0">Ваша история и аналитика</h2>
                <div id="past"><p>Здесь будет история и аналитика по всем розыгрышам, в которых вы будете участвовать.</p></div>
                <br><br>
              </div>
            </div>

            <div class="swiper-slide non-white-bg list-">
              <h2>Ваши настройки и бренды</h2>
              <p>На основе данных, указанными вами ниже, система предлагает наиболее интересные вам розыгрыши, а владельцы брендов узнают, какая аудитория их поддерживает &mdash; и придумывают для вас лучшие предложения и подарки.</p>

              <div class="accordion" id="accordionExample">
                <div style="margin-bottom: 5px;">
                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                        О вас
                      </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                      <div class="accordion-body">
                        <div id="mini_app_settings"></div>
                      </div>
                    </div>
                  </div>
                </div>
                <div id="brands">
                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
                        Бренды
                      </button>
                    </h2>
                    <div id="collapseTwo" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                      <div class="accordion-body">
                        <p>Выберите бренды, которые вы любите, точки продаж которых вы чаще всего посещаете, в розыгрыше подарков от которых вы хотели бы участвовать.</p>
                        <p style="font-size: 0.85em;">Если вы заметили, что какого-то бренда не хватает, пожалуйста, <a href="https://vk.com/adwesome" target="_blank">сообщите нам</a>.</p>
                        <div id="list" class="section"><p><b>Пожалуйста, подождите, список организаций загружается...</b></p></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="swiper-pagination swiper-outer-pagination"></div>
        </div>
      </div>
    </div>

  </body>
</html>
